<style>
    .header {
        max-width: 100%;
    }
    .video-overlay {
        width: 100%;
        height: 100%;
        position: absolute;
        background-color: rgba(0, 0, 0, 0.1);
        z-index: 10;
        color: #FFFFFF;
        font-size: 36px;
    }
    .comment-container {
        width: 100%;
        position: absolute;
    }
    .comment-item {
        width: 100%;
        font-family: LiHei Pro, "helvetica neue", helvetica, arial, "microsoft jhenghei", "Heiti TC", sans-serif;
        text-shadow: 0px 0px 10px rgba(150, 150, 150, 1);
        font-size: 30px;
        line-height: 42px;
    }
    .comment-img-wrapper {
        position: relative;
        float: left;
    }
    .comment-img {
    }
    .loc-start {
        top: 0px;
        left: 1500px;
    }
    .video-section {
        background-color: #000000;
    }
    .bot-video {
        margin-top: 32px;
    }
</style>
<div class="header">
    <img width="100%" src="https://dl.dropboxusercontent.com/u/7120885/botday/header.jpg" />
</div>
<div class="video-overlay">
    <!--<div class="comment-item">測試留言 A</div>-->
</div>
    <div class="video-section">
        <!-- sample video -->
        <!--<video class="bot-video" width="100%" height="100%" autobuffer controls autoplay>
            <source id="mp4" src="http://grochtdreis.de/fuer-jsfiddle/video/sintel_trailer-480.mp4" type="video/mp4">
        </video>-->
        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/1ZpCNbc6QIQ?autoplay=1&start=7660" frameborder="0" allowfullscreen></iframe>
</div>
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script type="text/javascript">
$(document).ready(function() {
    //var GET_COMMENT_API = "http://localhost:3000/bot/getcomment",
    var GET_COMMENT_API = "http://hack.wjhuang.net:3000/bot/getcomment",
        CONST_TIME_INTERVAL = 2000;
    var STREAMING_CONF = {
        'left': ['1', '2', '3', '4', '5'],
        "fontSize": ['18', '24', '28', '32'],
        "top": ['60', '120', '180', '240', '300', '360', '420', '330', '390', '450'],
        "speed": ['5', '5.5', '6'],
        "color": ['#FFFFFF']
    };
    var STREAMING_SYNTAX = [{
        "id": "1",
        "pattern": "[LIKE]",
        "icon": "https://dl.dropboxusercontent.com/u/7120885/botday/icon/bot-love.png",
    },{
        "id": "2",
        "pattern": "[BALL]",
        "icon": "https://dl.dropboxusercontent.com/u/7120885/botday/icon/bot-ball.png",
    },{
        "id": "3",
        "pattern": "謝謝",
        "icon": "https://dl.dropboxusercontent.com/u/7120885/botday/icon/bot-thanks.png"
    }];
    var CONST_COMMENT_START_POS = "-600px";

    /* setInterval and reach comment */
    setInterval(function(){
        $.getJSON(GET_COMMENT_API, function(data) {
            console.log("data", data);
            // get comment
            if (data[0]['status'] === 'ok') {
                for(var i=0;i<data[1]['comment'].length;i++) {
                    var comment = data[1]['comment'][i];

                    /* random */
                    var getTop = Math.floor((Math.random() * STREAMING_CONF.top.length));
                    var getLeft = Math.floor((Math.random() * STREAMING_CONF.left.length));
                    var getSpeed = Math.floor((Math.random() * STREAMING_CONF.speed.length));
                    var getFontSize = Math.floor((Math.random() * STREAMING_CONF.fontSize.length));
                    var getColor = Math.floor((Math.random() * STREAMING_CONF.color.length));

                    var comment_container = document.createElement('div');
                    var comment_item = document.createElement('div');
                    var comment_img_wrapper = document.createElement('div');
                    var comment_img = document.createElement('img');

                    /* comment container */
                    $(comment_container).addClass('comment-container')
                                        .addClass("loc-start")
                                        .css({
                                            'top': (STREAMING_CONF.top[getTop]*1.2) + "px",
                                            'left': ($(window).width() + STREAMING_CONF.left[getLeft] * 50) + "px",
                                            'fontSize': (STREAMING_CONF.fontSize[getFontSize] + "px"),
                                            'color': STREAMING_CONF.color[getColor]
                                        });

                    /* img container */
                    for($icon_checker=0;$icon_checker<STREAMING_SYNTAX.length;$icon_checker++){
                        // replace the syntax
                        if (comment.indexOf(STREAMING_SYNTAX[$icon_checker].pattern) != '-1') {
                            $(comment_img).addClass("comment-img")
                                          .attr("src", STREAMING_SYNTAX[$icon_checker].icon)
                                          .appendTo($(comment_img_wrapper));
                            $(comment_img_wrapper).addClass("comment-img-wrapper").appendTo($(comment_container));
                        }
                        if (STREAMING_SYNTAX[$icon_checker].id != '3') {
                            comment = comment.replace(STREAMING_SYNTAX[$icon_checker].pattern, "");
                        }
                    }

                    /* text container */
                    $(comment_item).text(comment).addClass('comment-item').appendTo(comment_container);
                    $(comment_container).animate({
                        left: CONST_COMMENT_START_POS,
                    }, (STREAMING_CONF.speed[getSpeed] * 2000)).appendTo($(".video-overlay"));

                }
            // no comment
            } else if (data[0]['status'] === 'empty') {
                //console.log("empty");
            }
        });
    }, CONST_TIME_INTERVAL);

});
</script>
